SUMMARY="Programming language designed for technical computing"
DESCRIPTION="Julia is a high-level, high-performance dynamic programming \
language for technical computing, with syntax that is familiar to users of \
other technical computing environments. It provides a sophisticated compiler, \
distributed parallel execution, numerical accuracy, and an extensive \
mathematical function library. The library, largely written in Julia itself, \
also integrates mature, best-of-breed C and Fortran libraries for linear \
algebra, random number generation, signal processing, and string processing. \
In addition, the Julia developer community is contributing a number of \
external packages through Juliaâ€™s built-in package manager at a rapid pace."
HOMEPAGE="https://julialang.org/"
COPYRIGHT="2009-2014 Jeff Bezanson et al."
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/JuliaLang/julia/archive/refs/tags/v$portVersion.tar.gz"
CHECKSUM_SHA256="3c39bf9909ed358c73d122099359ddf79d49ffe43cb87a47913d32c947295d61"
PATCHES="julia-$portVersion.patchset"

# Currently broken on all architectures, due to openlibm needing <complex.h>
# which we do not have.
ARCHITECTURES="?all !x86_gcc2"
#SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	julia$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libuv$secondaryArchSuffix
	lib:libpcre$secondaryArchSuffix
	lib:libgmp$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libcurl$secondaryArchSuffix
	devel:libgit2$secondaryArchSuffix
	devel:libgmp$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
	devel:liblapack$secondaryArchSuffix
	devel:libLLVM_12$secondaryArchSuffix
	devel:libmbedtls$secondaryArchSuffix
	devel:libmpfr$secondaryArchSuffix
	devel:libopenblas$secondaryArchSuffix
	devel:libsuitesparseconfig$secondaryArchSuffix
	devel:libssh2$secondaryArchSuffix
	devel:libunwind$secondaryArchSuffix
	devel:libuv$secondaryArchSuffix
	devel:libpcre$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:find
	cmd:g++$secondaryArchSuffix
	cmd:gcc$secondaryArchSuffix
	cmd:gfortran$secondaryArchSuffix
	cmd:make
	cmd:perl
	cmd:git
	cmd:m4
	cmd:patch
	cmd:pcre2_config
	cmd:pkg_config
	cmd:python3
	cmd:cmake
	cmd:tar
	cmd:which
	"

makeJulia()
{
	make prefix=/usr \
		bindir=/usr/bin \
		sysconfdir=/etc \
		libexecdir=/usr/lib \
		USE_SYSTEM_LIBUV=1 \
		USE_BINARYBUILDER=0 \
		USE_SYSTEM_PCRE=1 \
		USE_SYSTEM_GMP=1 \
		USE_SYSTEM_MPFR=1 \
		USE_SYSTEM_LIBSUITESPARSE=1 \
		USE_SYSTEM_LIBSSH2=1 \
		USE_SYSTEM_NGHTTP2=1 \
		USE_SYSTEM_MBEDTLS=1 \
		USE_SYSTEM_CURL=1 \
		USE_SYSTEM_LIBGIT2=1 \
		USE_SYSTEM_ZLIB=1 \
		USE_SYSTEM_BLAS=1 \
		USE_SYSTEM_LAPACK=1 \
		USE_SYSTEM_LLVM=1 \
		USE_SYSTEM_LIBUNWIND=1 \
		USE_SYSTEM_CSL=1 \
		"$@"
}

BUILD()
{
	export LDFLAGS="-lbsd -liconv"
	makeJulia $jobArgs
}

INSTALL()
{
	# todo
	exit 1
}
