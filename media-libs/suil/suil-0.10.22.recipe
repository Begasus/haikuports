SUMMARY="Library for loading and wrapping LV2 plugin UIs"
DESCRIPTION="Suil is a library for loading and wrapping LV2 plugin UIs. It provides wrappers that \
allow Gtk and Qt hosts to load, and potentially embed, plugin GUIs that use the 'native' \
windowing API (Coca, WIN32, or X11)."
HOMEPAGE="https://gitlab.com/lv2/suil"
COPYRIGHT="2007-2022 David Robillard"
LICENSE="ISC"
REVISION="1"
SOURCE_URI="https://gitlab.com/lv2/suil/-/archive/v$portVersion/suil-v$portVersion.tar.bz2"
CHECKSUM_SHA256="c454067682db99c31a504c773219dcb6ead4d949d0183ab075ead2c84054b0ff"
SOURCE_DIR="suil-v$portVersion"

ARCHITECTURES="?all ?x86_gcc2"
SECONDARY_ARCHITECTURES="?x86"

libVersion="$portVersion"
libVersionCompat="$libVersion compat >= ${libVersion%%.*}"

PROVIDES="
	suil$secondaryArchSuffix = $portVersion
	lib:libsuil_0$secondaryArchSuffix = $libVersionCompat
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libX11$secondaryArchSuffix
	"

PROVIDES_devel="
	suil${secondaryArchSuffix}_devel = $portVersion
	devel:libsuil_0$secondaryArchSuffix = $libVersionCompat
	"
REQUIRES_devel="
	suil$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libgtk_3$secondaryArchSuffix
	devel:liblilv_0$secondaryArchSuffix
	devel:libX11$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:doxygen
	cmd:gcc$secondaryArchSuffix
	cmd:meson
	cmd:ninja
	cmd:pkg_config$secondaryArchSuffix
	"

BUILD()
{
	meson Build \
		--buildtype=release \
		--prefix=$prefix \
		-Dgtk3=enabled

	ninja -v -C Build
}

INSTALL()
{
	ninja -C Build install

	prepareInstalledDevelLib \
		libsuil-0
	fixPkgconfig

	packageEntries devel \
		"$developDir"
}

TEST()
{
	ninja -C Build test
}
